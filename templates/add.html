<!DOCTYPE html>
<html>
<head>
	<title>Product List</title>
	<link rel="stylesheet" href="static/style.css">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

	<style>
		table {
			border-collapse: collapse;
			width: 100%;
		}
		
		th, td {
			text-align: left;
			padding: 8px;
			border-bottom: 1px solid #ddd;
		}
		
		tr:hover {
			background-color: #f5f5f5;
		}
		
		.add-row {
			display: flex;
			align-items: center;
		}
		
		.add-row input[type="text"], .add-row input[type="number"] {
			padding: 8px;
			margin-right: 8px;
			border: none;
			border-bottom: 1px solid #ddd;
			width: 50%;
		}
		
		.add-row button {
			padding: 8px;
			background-color: #4CAF50;
			color: white;
			border: none;
			cursor: pointer;
		}
	</style>
</head>
<body>
	<header>
		<img src="static/icon.png" class="icon" alt=" ">
		<a class="nav-button">
			для новых пользователей
		</a>
		<a class="nav-button">
			о том как начать с нами работать
		</a>
		<a class="nav-button">
			вход/регистрация
		</a>

		<datalist id="products-list">
			{% for el in products %}
				<option value="{{ el }}">
			{% endfor %}
		</datalist>
	</header>
	<div class="table-redactor">
	<table>
		<thead>
			<tr>
				<th>Продукт</th>
				<th>Потрачено</th>
				<th>Количество</th>
				<th>Поставщик</th>
			</tr>
		</thead>
		<tbody id="product-list">
			{% for row in data %}
			<tr>
				<td>
					<input list="products-list" id="product" name="product" value="{{ row['name'] }}">
				</td>
				<td> {{ row["consumption_week"] }} </td>
				{% if row["name"] in products %}
					<td><input type="number" name="order_count" value="{{ row.order_count }}" min="0"></td>
				{% else %}
					<td><input type="number" name="order_count" value="{{ row.order_count }}" min="0"></td>
				{% endif %}
				<td><select name="supplier">
						{% for supplier in suppliers %}
							{% if supplier == row.supplier %}
								<option value="{{ row.supplier }}" selected>{{ row.supplier }}</option>
							{% else %}
								<option value="{{ supplier }}">{{ supplier }}</option>
							{% endif %}
						{% endfor %}
					</select>
				</td>
			</tr>
			{% endfor %}
		</tbody>
	</table>

	<div class="add-row">
		<input list="products-list" id="product_name" name="product_name" value="">
		<!-- <input type="number" name="consumption_week" placeholder="0" value="0"> -->
		<input type="number" name="product_count" placeholder="Количество" min="0">
		<select name="supplier">
			{% for supplier in suppliers %}
			<option value="{{ supplier }}">{{ supplier }}</option>
			{% endfor %}
		</select>
		<button id="add_row">+</button>
	</div>
	</div>
    <script>
        const addRowButton = document.getElementById('add_row');
        const table = document.querySelector('table tbody');
        
        addRowButton.addEventListener('click', function() {
          const newRow = document.createElement('tr');
          const productName = document.querySelector('input[name="product_name"]').value;
          //const productNameForTable = '<input list="products-list" id="ice-cream-choice" name="ice-cream-choice" value="' + productName + '">';
          const productCount = parseInt(document.querySelector('input[name="product_count"]').value);
          const supplier = document.querySelector('select[name="supplier"]').innerHTML;
          if (!productName || productCount < 0) {
            return;
          }
          const newCells = [
            document.createElement('td'),
            document.createElement('td'),
            document.createElement('td'),
            document.createElement('td'),
            document.createElement('td'),
          ];
          
          newCells[0].innerHTML = productName;
          newCells[1].textContent = 0;
          newCells[2].innerHTML = '<input type="number" name="order_count" value="' + productCount + '" min="0">';
          newCells[3].innerHTML = '<select name="supplier">' + supplier + '</select>';
          newCells[4].innerHTML = '<button>-</button>';
          
          newCells[4].querySelector('button').addEventListener('click', function() {
            newRow.remove();
          });
          
          newRow.append(...newCells);
          table.append(newRow);
          
          document.querySelector('input[name="product_name"]').value = '';
          document.querySelector('input[name="product_count"]').value = '';
        });
      </script>
	
</body>
</html>